<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">
    <title>Image Converter (Shell script)</title>

    <!-- CSS -->
    <link rel="stylesheet" href="../css/styles.css">

    <!-- Google Fonts: Montserrat and Ubuntu. Currently not used.-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Sacramento&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">


    <!-- Font awesome -->
    <script src="https://kit.fontawesome.com/181c7bc6bd.js" crossorigin="anonymous"></script>


    <!-- Javascript -->
    <script src="../index.js" charset="utf-8"></script>

</head>



<body>


    <section id="nav">
        <!-- <div class="container-fluid"> -->
        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- AddToAny BEGIN -->
            <div class="a2a_kit a2a_kit_size_32 a2a_default_style" style="float: left; margin-left: 20px;">
                <!-- <a class="a2a_dd" href="https://www.addtoany.com/share"></a> -->
                <a class="a2a_button_linkedin"></a>
                <a class="a2a_button_facebook"></a>
                <a class="a2a_button_whatsapp"></a>
                <a class="a2a_button_twitter"></a>
                <a class="a2a_button_email"></a>
                <a class="a2a_button_google_gmail"></a>
            </div>
            <script async src="https://static.addtoany.com/menu/page.js"></script>
            <!-- AddToAny END -->

            <!-- Links at top right will collapse -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">

                <ul class="navbar-nav ms-auto">

                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">Home</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="../index.html#projects">Projects</a>
                    </li>

                    <li class="nav-item">
                        <a href="../index.html#blog" class="nav-link">Blog</a>
                    </li>

                    <li class="nav-item">
                        <a href="../index.html#contact" class="nav-link">Contact</a>
                    </li>

                </ul>
            </div>

        </nav>

        <!-- </div> -->
    </section>

    <section>
        <div class="container-fluid">
            <div class="row">


                <div class="col-lg-12">


                    <h1 style="text-align:center" class="intro-padding">Image Converter (Shell Script)</h1>

                </div>
            </div>
        </div>
        <div class="container">

            <div class="row">
                <div class="col-lg-12">
                    <figure style="text-align: center;">
                        <!-- <img src="../Images/imageconverter/tux1.webp" alt="tux" width="700" height="auto"> -->
                        <img src="../Images/imageconverter/bash.webp" alt="tux" width="700" height="auto">
                    </figure>
                </div>
            </div>
        </div></br>
        <p>3 Feb '24</p>
        <p>
            I was inspired to create this tutorial while updating my personal website, which is this site that you are
            looking at. I had logged into my web-hosting administrator's page and out of curiosity, decided to explore
            host-provider's inbuilt web performance monitoring tool. It was a tool which could analyse how optimised my
            website was. When
            the report was generated, I was surprised to find out that the website was running sub-optimally. The report
            provided a list of suggestions on how my website can be optimised, one of which was to use '.webp' images
            instead of the usual '.png' and '.jpeg' images.
        </p>
        <p>On doing a search, I found out that WebP, which has a file extension of '.webp', is an image format developed
            by Google that provides both lossy and lossless compression for images on the web. It aims to create smaller
            file sizes without compromising image quality, thus helping web pages load faster. The conversion from other
            image formats to WebP can be done using the 'cwebp' command line tool by Google.

        <div class="container">
            <pre class="preStyle">
    cwebp input.jpg -o output.webp

</pre><br>
        </div>

        </p>
        <p>I tried it out on a jpeg file and it worked nicely. But a bigger problem loomed ahead. All the images used in
            the website were of .png or .jpeg formats. Converting each image manually to .webp would be a painstaking
            task. So, being the software engineer that I am, the idea of automation instantly came to mind. Having taken
            a few courses on Linux which covered shell scripting, I thought it would be a good idea to experiment with
            automating the image conversion. So, the process of creating a Bash script began. Click <a
                href=https://github.com/nchinling/image_converter_script>here</a> for the Github repository.
        </p>
        <p><u>Script requirements</u></p>
        <p>The first step was to decide on the requirements. Besides converting an image to WebP format, it should work
            down from a root directory. In other words, it should recursively convert images which are inside a child
            directory.
        </p>
        <p><u>Coding</u></p>
        <div class="container">
            <ol>
                <li>Click The script begins with '#!/bin/bash'. It specifies that the Bash shell interpreter will be
                    used to
                    run
                    the
                    commands in the script. Aftert that, create a function. Let's call it 'convert_jpeg_to_webp'. At
                    this
                    point, the script should look like below.</li>


                <pre class="preStyle">
    #!/bin/bash

    convert_jpeg_to_webp() {
    
    }

</pre><br>


                <li>Initialise two local variables, 'dir' and 'file'. 'dir' is a directory variable which will
                    hold the value of the first
                    argument
                    passed
                    to the function. Run the function below the function code using 'convert_jpeg_to_webp "$(pwd)"' to
                    inform the script to work on the present work directory. </li>


                <pre class="preStyle">
    #!/bin/bash

    convert_jpeg_to_webp() {
    local dir="$1"
    local file

    # to implement

    }

    convert_jpeg_to_webp "$(pwd)"

        </pre><br>

                <li>
                    A 'for' loop iterates over each file in the present work directory ($dir).

                    Within the loop, an 'if' statement checks if the current item ($file) is a directory using the -d
                    flag.
                    If it is, the function calls itself recursively with the current directory ("$file")
                    as an argument. This recursive call allows the function to traverse nested directories.

                    <pre class="preStyle">
    #!/bin/bash

    convert_jpeg_to_webp() {
        local dir="$1"
        local file
    
        # Loop through files and directories in the current directory
        for file in "$dir"/*; do
            if [ -d "$file" ]; then
                # If the item is a directory, call the function recursively
                convert_jpeg_to_webp "$file"
            
            fi
        done
    }
    
    convert_jpeg_to_webp "$(pwd)"

        </pre><br>

                </li>
                <li>
                    If the item is a regular file (-f "$file") and has a file extension of .jpg or .jpeg, the script
                    converts it to WebP format.

                    <pre class="preStyle">
    #!/bin/bash

    convert_jpeg_to_webp() {
        local dir="$1"
        local file
    
        # Loop through files and directories in the current directory
        for file in "$dir"/*; do
            if [ -d "$file" ]; then
                # If the item is a directory, call the function recursively
                convert_jpeg_to_webp "$file"
            elif [ -f "$file" ] && { [[ "$file" == *.jpg ]] || [[ "$file" == *.jpeg ]]; }; then
                # If the item is a JPEG file, convert it to WebP format
                filename=$(basename "$file")
                cwebp "$file" -o "${file%.*}.webp"
        
            fi
        done
    }
    
    convert_jpeg_to_webp "$(pwd)"

            </pre><br>

                </li>
                <li>
                    The cwebp command converts the JPEG file to WebP format. The
                    output file is named with the same base name as the original JPEG file but with the .webp extension.
                </li>
                <li>
                    After conversion, a message is printed to the console indicating that the file has been successfully
                    converted. This is how the entire <a
                        href=https://github.com/nchinling/image_converter_script/blob/main/convert_jpeg_to_webp.sh>script</a>
                    looks like.

                    <div class="container">

                        <div class="row">
                            <div class="col-lg-12">
                                <figure style="text-align: center;">
                                    <img src="../Images/imageconverter/jpegtowebpimage.webp" alt="imagescript"
                                        width="700" height="auto">
                                </figure>
                            </div>
                        </div>
                    </div></br>
                </li>
            </ol>
        </div>

        <p><u>Running the script</u></p>
        <div class="container">
            <ol>
                <li>By default, a newly created script is not executable. Change the permission of the script using
                    'chmod
                    +x
                    script_name'. This grants execute permission to all categories of users. If permission is to be
                    granted
                    to
                    only the owner, add the letter 'u' to the beginning '+x'. e.g. 'chmod u+x
                    script_name'.


                    <pre class="preStyle">
    chmod +x convert_jpeg_to_webp.sh

</pre><br>

                </li>
                <li>Run the script using ./script_name.

                    <pre class="preStyle">
    ./convert_jpeg_to_webp.sh

</pre><br>

                </li>
                <li>Remove the jpeg files which are not needed. The 'find' command recursively searches the current
                    directory and its subdirectories for files which have
                    image formats of .jpeg, .jpg or .png and deletes them.

                    <pre class="preStyle">
    find . -type f \( -name "*.jpeg" -o -name "*.jpg" -o -name "*.png" \) -delete

</pre><br>

                </li>
            </ol>
        </div>
        <p><u>Improvements</u></p>
        <p>From here, we can
            think of various ways to modify and extend the functionality of the script, such as converting png to webp,
            or from any format to another format. </p>
        <p>In fact, as the file types are currently hardcoded, we can consider the use of variables, thus making the
            script more
            robust. Refer to my <a href=https://github.com/nchinling/image_converter_script>Github
                repo</a> for variants of the above script. Finally, we can also implement the removal of the original
            file images using the script, instead of manually keying it into the terminal, as done earlier.</p>
        <p><u>Conclusion</u></p>
        <p>This is all for the tutorial. We have seen how we can create a bash script to automate the conversion of file
            images from one format to another, thus saving a lot of time. This is one of the advantages of using Linux
            instead of other operating systems. I experienced firsthand the practical advantages of the command line
            through this mini-project. I have shown a basic implementation of the script, while exploring
            possible implementations to improve on the existing code. Hope that you have found the tutorial useful.
            &#128522;</p><br>







    </section>


    <hr>


    <section id=footer>

        <table>

            <tr>
                <td>

                    <a class="footer-style" href="../index.html"> Home</a>

                </td>
                <td>

                    <a class="footer-style" href="../index.html#projects"> Projects</a>

                </td>

                <td>

                    <a class="footer-style" href="../index.html#blog"> Blog</a>

                </td>
            </tr>

        </table><br>
    </section>

    <!-- Bootstrap - Javascript -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js"
        integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk"
        crossorigin="anonymous"></script>


</body>

</html>